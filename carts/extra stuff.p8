pico-8 cartridge // http://www.pico-8.com
version 16
__lua__

--globals
objects = {}
types = {}


function _init()
	cls()
	lasers={}
	enemies={}
	walls={}
	score=0
	spawn_enemy=0
	game_over=false

	--player object
	player={
	x=10,
	y=2,
	dy=3,
	frame=0,
	d=2,
	lives=3,
	height=8,
	width=5,
	can_fire=false,
	fire_delay=0,
	draw=function(self)
		spr(self.frame, self.x, self.y)
	end,
	update=function(self)
		if btn(üÖæÔ∏è) then
			self.y -= self.dy
		else
			self.y += self.dy
		end
	
		if btn(‚ùé) and self.can_fire then
		--shoot laser
			add(lasers, make_laser(self.x+3,self.y))
			sfx(1)
			self.fire_delay = 7
		end
		self.d -= 1
		self.fire_delay -= 1
		if self.fire_delay < 1 then
			self.can_fire = true
		else
			self.can_fire = false
		end

		if self.d < 0 then

			self.frame += 1
			if self.frame > 1 then self.frame = 0 end
			self.d = 4
		end

		if self.y > 119 then
			self.y = 120
		end

		if self.y < 1 then
			self.y = 0
		end
	end
	}

end

function _update()
	player:update()
	for laser in all(lasers) do
		laser:update()
		--check for collision between lasers and enemies
		for enemy in all(enemies) do
			if check_for_collision(laser, enemy) then
				del(lasers, laser)
				del(enemies, enemy)
				sfx(0)
				score = score + 100
			end
		end
	end
	--spawn enemies
	spawn_enemy += 1
	if spawn_enemy > 40 then
		add(enemies, make_enemy(136, rnd(122)))
		spawn_enemy = 0
	end
	for enemy in all(enemies) do
		enemy:update()
		if check_for_collision(player, enemy) then
			del(enemies, enemy)
			player.lives -= 1
			sfx(3)
		end
	end
	if spawn_enemy > 39 then
		add(walls, make_wall(140, 10, 4, 4))
		spawn_enemy = 0
	end
	foreach(walls, update)
end

function _draw()
	cls()
	if player.lives > 0 then
		player:draw()
	end
	for laser in all(lasers) do
		laser:draw()
	end
	for enemy in all(enemies) do
		enemy:draw()
	end
	for wall in all(walls) do
		wall:draw()
	end
	print(score, 1, 1, 3)
	for i=1, player.lives do
		print("‚ô•", 100+i*6, 1, 8)
	end
end


--create instance of laser
function make_laser(x,y)
	local laser={
	x=x,
	y=y,
	dx=3,
	width=3;
	height=1;
	is_collided_horiz=false,
	is_collided_vert=false,
	draw=function(self)
		line(self.x, self.y, self.x+self.width, self.y, 10)
	end,
	update=function(self)
		self.x += self.dx
	end
	}
	return laser
end

--spawn enemy
function make_enemy(x,y)
	local enemy={
		x=x,
		y=y,
		dx=3,
		width=8,
		height=8,
		draw=function(self)
			spr(8, self.x, self.y)
		end,
		update=function(self)
			self.x -= self.dx
			if self.x < -9 then
				self.x = 136
			end
		end
	}
	return enemy
end

--spawn walls
function make_wall(x, y, width, height)
	local wall={
		x=x,
		y=y,
		dx=3,
		width=width,
		height=height,
		draw=function(self)
			rectfill(self.x, self.y, self.width, self.height, 3)
		end,
		update=function(self)
			self.x -= self.dx
			if self.x < -9 then
				del(walls, self)
			end
		end
	}
	return wall
end

laser = {

}

--create object
function init_object(type, x, y)
	local obj = {}
	obj.type = type
	obj.collidable = true
	obj.x = x
	obj.y = y
	obj.hitbox = {x=0, y=0, w=8, h=8}
	add(objects,obj)
	if obj.type.init~=nil then
		obj.type.init(obj)
	end
	return obj


end

function delete_object(obj)
	del(objects, obj)
end

--check for collision
function check_for_collision(obj1, obj2)
	local is_collided_horiz = false
	local is_collided_vert = false
	local collision_detected = false
	if obj1.x + obj1.width > obj2.x and obj2.x + obj2.width > obj1.x then
			is_collided_horiz = true
		else
			is_collided_horiz = false
		end
		if obj1.y + obj1.height > obj2.y and obj2.y + obj2.height > obj1.y then
			is_collided_vert = true
		else
			is_collided_vert = false
		end
		if is_collided_horiz and is_collided_vert then
			collision_detected = true
		end
		return collision_detected
end


__gfx__
0000000000077000000770000000a0000000000000000000000000006666666d8888800070000007001111000000000000000000444444444444444444444444
000000000007700000077000000aaa00000bb00000088000000cc0006666666d8000800007000070011111100800008000000000555555555555555555555555
00000000005700000057000000aaaaa000bbbb0000887800007cc70000000880880880000077770011111611088008800000000053b3b333b3bb333333b33b35
0000000000777000007770000aaaaaaa0bb77bb0088778800cc77cc00000888808080000008787001111116100000000000000003b333b333b333b333b333b33
00000000075707000757070009aaaaa903bbbb30048788400dccccd0000088880888000000878700111111110000000000000000353333333b3333bb333b3335
000000000087000000970000009aaa90003bb3000048840000dccd00000008808080800000777700111111110000000000000000b3b3b33b33b3bbb3b3b33b33
0000000000707000007070000009a9000003300000044000000dd0006666666d080800000700007001111110000000000000000053333b33bb333b33bbb33bb5
000000000700070007000700000090000000000000000000000000006666666d80008000700000070011110000000000000000003b33b3b3bb3333333bbb3335
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000055333bb3b33b3b33b3b33b53
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000033b3333b33b3333b33333335
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000333333333333bb33333b3b3b
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005b333b333bbb33333b33bb35
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b33333333b333b333b33b5b
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005bb3b33b3bb3bbbb3bb333bb
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b33bb3bbb333bb333333b35
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003533b3bb3bbbb3333b33333b
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005bb33b33b3b3bb33bb3b3b53
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000033b3b33bb3b3333b33b3333b
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005333bb3bb333333333b33335
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b333bb33b333bbb3b333b53
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b5b3333bb3333bb33bb3b333
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000053bb3b3bb3b333bb333b333b
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000033333bbb33333b333bb33b35
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005b0333030b3300303b0bb033
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777777777777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777777777777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777777777777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777777777777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777777777777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777777777777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000777777000000000000777000000000000000000000000000000000000000777000000000000000000000000000000000000000000000000000
00000000000000777777000000000000777000000000000000000000000000000000000000777000000000000000000000000000000000000000000000000000
00000000000000777777000000000000777000000000000000000000000000000000000000777000000000000000000000000000000000000000000000000000
00000000000000777777077777777770777000000000000000000000000000000000000000777000000000000000000000000000000000000000000000000000
00000000000000777777077777777770777777770777777777770777777777007777777770777007770000000000000000000000000000000000000000000000
00000000000000777777077777777770777777770777777777770777777777007777777770777077770000000000000000000000000000000000000000000000
00000000000000777777077700007770777777770777777777770777777777007777777770777777770000000000000000000000000000000000000000000000
00000000000000777777077777777770777000000777000007770777000777007770000000777777700000000000000000000000000000000000000000000000
07777777777777777777077777777770777000000777000007770777000777007770000000777777000000000000000000000000000000000000000000000000
07777777777777777777077777777770777000000777000007770777000777007770000000777770000000000000000000000000000000000000000000000000
07777777777777777777077700000000777000000777000007770777000777007770000000777777000000000000000000000000000000000000000000000000
07777777777777777777077700000000777000000777000007770777000777007770000000777777700000000000000000000000000000000000000000000000
07777777777777777777077777777770777777770777777777770777777777707777777770777777770000000000000000000000000000000000000000000000
07777777777777777770077777777770777777770777777777770777777777707777777770777077770000000000000000000000000000000000000000000000
07777777777777777770077777777770777777770777777777770777777777707777777770777007770000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000777000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000777000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000777000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777700000000000000000000000777000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777700000000000000000000000777000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777700000000000000000000000777000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777700000000000000000000000777000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777700000000000000000000000777000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777700000000000000000000000777000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000077777700000000000000000000000777000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000077777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000077777700000000000000000000000777000000077700000000000000000000000000000000000000000000000000000000000000000000000000
07777770000077777700000000000000000000000777000000077700000000000000000000000000000000000000000000000000000000000000000000000000
07777770000077777700000000000000000000000777000000077700000000000000000000000000000000000000000000000000000000000000000000000000
07777770000077777700000000000000000000000777000000077700000000000000000000000000000000000000000000000000000000000000000000000000
07777770000077777700000000000000000000000777000000077700000000000000000000000000000000000000000000000000000000000000000000000000
07777770000077777700000000000000000000000777000000077700000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777777777770777777777777770777000000077700000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777777777770777777777777770777000000077700000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777777777770777777777777770777777777777700000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777777777770777000000007770777777777777700000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777777777770777000000007770777777777777700000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777777777770777000000007770000007770000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000000000007777770777000000007770000007770000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000000000007777770777000000007770000007770000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000000000007777770777000000007770000007770000000000000000000000000000000000000000000000000000000000000000000000000000000
07777770000000000007777770777000000007770000007770000000000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777777777770777000000007770000007770000000000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777777777770777000000007770000007770000000000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777777777770777000000007770000007770000000000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777777777770777777777777770000007770000000000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777777777770777777777777770000007770000000000000000000000000000000000000000000000000000000000000000000000000000000
07777777777777777777777770777777777777770000007770000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010ef2b3b0c00000000000000000000000000060608080000000000000000000000000000000000000000000000000008000c06060808000000000000000000
__map__
1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00010000001e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000001e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000001e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000001e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000001e00000000001e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000001e00000000001e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000001e00000000001e1e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000071e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000001e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000001e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000001e0000001e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000001e0000001e0000000000001e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000001e0000001e0000000000001e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e1e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000300000c0700c0700d0700f0701107013070160701a0701e0702307000000000002f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00030000252501b250152500e2500c2502c0002c0002b0002a0002900028000280002800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01100101006500000000650136502f650186500000013650000000000000000000002f65000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000200003365031650306502f6502d640286402c6402a640296402863022630256202462022620216201b6201f6201b62019610176101561012610106100d6000a60008600066000460000000000000000000000
